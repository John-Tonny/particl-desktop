<app-header>
  <div class="tab-bar" fxLayout fxLayoutAlign="space-between stretch">

    <mat-tab-group (selectChange)="selectTab($event.index)" fxFlex="1 1 100%">
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon fontSet="partIcon" fontIcon="part-send"></mat-icon>
          付款
        </ng-template>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon fontSet="partIcon" fontIcon="part-transfer"></mat-icon>
          地址转换（公开地址-私有地址）
        </ng-template>
      </mat-tab>
    </mat-tab-group>

    <div class="buttons">
      <button mat-button (click)="advanced = !advanced" class="small advanced-options">
        <mat-icon fontSet="partIcon" fontIcon="{{ (advanced) ? 'part-circle-minus': 'part-circle-plus' }}"></mat-icon>
        <span>选项</span>
      </button>
    </div>

  </div><!-- .tab-bar -->
</app-header>


<div class="container-block with-tab-bar">

  <div class="page-intro">
    <h1 *ngIf="type === 'sendPayment'">付款</h1>
    <h1 *ngIf="type === 'balanceTransfer'">转换(交易类型)</h1>
    <div class="content">
      <p *ngIf="type === 'sendPayment'">
	在本页面的“地址类型”列表中选择您的地址类型，将能够调整您交易的隐私级别。
      </p>
      <p *ngIf="type === 'balanceTransfer'">
        Convert your coins between public and private balances.<br>
      	为了保护您的隐私，建议您总是把您的余额放在私有地址里（例如：混肴或匿名）。
      </p>
      <p class="widget-help">
	混肴和匿名交易有何区别，它们是保护您的隐私，想了解更多内容可以在维公链的Wiki：
        <a mat-button  target = "_blank" href="https://particl.wiki/currency-types" class="small">
          <mat-icon fontSet="partIcon" fontIcon="part-wikipedia"></mat-icon>
          交易类型
        </a>
      </p>
    </div>
  </div><!-- .page-intro -->

  <div fxLayout="row" fxLayoutGap="35px">
  
    <div class="from-box" fxFlex="0 0 320px">
      <div class="sticky">
        <div class="section-title">地址类型</div>
        <mat-card>
          <!-- Select "FROM" balance/account -->
          <mat-radio-group class="from-balance-type block-radio" name="sendInput" [(ngModel)]="send.input" 
                            fxLayout="column" fxLayoutGap="10px" (change)="updateAmount()">
            <mat-radio-button class="balance" value="part" checked="checked" color="primary"
                              (change)="setInputOutput('part', 'output')" fxFlex >
              <div class="name">公开</div>
              <div class="desc">可用余额:<span class="amount">{{ availableBalance('part') }}</span></div>
            </mat-radio-button>
            <mat-radio-button class="balance" value="blind" fxFlex color="primary" (change)="setInputOutput('blind', 'output')" >
              <div class="name">混肴</div>
              <div class="desc">可用余额:<span *ngIf="!checkBalance('blind')" class="amount">{{ availableBalance('blind') }}</span>
                <mat-icon *ngIf="checkBalance('blind')" fontSet="partIcon" fontIcon="part-circle-question" class="help-icon"
                          matTooltip="即使所有余额转入混肴模式，混肴可用余额显示仍然很小，这是基于维公链的私密保护。"></mat-icon>
              </div>
            </mat-radio-button>
            <mat-radio-button *ngIf="testnet" class="balance" value="anon" color="primary" (change)="setInputOutput('anon', 'output')" fxFlex >
              <div class="name">匿名</div>
              <div class="desc">可用余额:<span class="amount">{{ availableBalance('anon') }}</span></div>
            </mat-radio-button>
          </mat-radio-group><!-- .from-balance-type -->
    
          <!-- TX info help -->
          <p class="widget-help" *ngIf="send.input === 'part'">
	    使用公开地址交易，在区块链上任何人都能够看到交易金额、发送方和接收方地址。	    
          </p>
          <p class="widget-help" *ngIf="send.input === 'blind'">
            使用混肴地址交易，则隐藏交易金额，在区块链仅仅能够看到发送方和接收方的地址。
          </p>
          <p class="widget-help" *ngIf="send.input === 'anon'">
            使用匿名交易，则提供最高级别的隐私保护，在区块链上将无法看到交易金额、发送方和接收方的真实信息。
	    隐私级别越高，需要支付的费用越大，高级用户还可以进一步调整环签名的数量。 
          </p>
    
          <!-- Show privacy slider if anonymous TX -->
          <div *ngIf="send.input === 'anon' && advanced" class="advanced">
            <div class="subtitle">Privacy level <small>(no. of ring sigs)</small></div>
            <div class="privacy-level">
              <div class="privacy-labels" fxLayout="row" fxLayoutAlign="space-between center">
                <span
                  fxFlex="0 0 50px"
                  class="privacy-label low"
                  (click)="setPrivacy(4)"
                  matTooltip="低隐私保护"
                  matTooltipPosition="below">Low
                </span>
                <span
                  fxFlex="0 0 50px"
                  class="privacy-label high"
                  (click)="setPrivacy(16)"
                  matTooltip="中隐私保护"
                  matTooltipPosition="below">High
                </span>
                <span
                  fxFlex="0 0 50px"
                  class="privacy-label highest"
                  (click)="setPrivacy(32)"
                  matTooltip="高隐私保护"
                  matTooltipPosition="below">Highest
                </span>
              </div><!-- .privacy-labels -->
    
              <mat-slider
                thumbLabel
                color="primary"
                [min]="3"
                (change)="onSlide($event)"
                [max]="32"
                [value]="send.ringsize">
              </mat-slider>
    
              <!-- set default value after clicking the button (8 signatures?) -->
              <button
                (click)="setPrivacy(8)"
                mat-button
                class="small"
                matTooltip="设置缺省值，建议私有模式">
                <mat-icon fontSet="partIcon" fontIcon="part-anon"></mat-icon>
                自动私有模式
              </button>
            </div><!-- .privacy-level -->
          </div><!-- /if Anon -->
        </mat-card>
      </div>
    </div><!-- .from-box -->



    <div class="to-box" fxFlex="1 1 100%">
      <form name="walletSendForm">

        <!-- Select "TO" balance/account (ONLY for Balance transfer) -->
        <div class="section-title" *ngIf="type === 'balanceTransfer'">
          转换为
        </div>
        <mat-card class="section to-balance-type" *ngIf="type === 'balanceTransfer'">
          <mat-radio-group class="to-balance-type block-radio" name="sendOutput" [(ngModel)]="send.output"
                          fxLayout="column" fxLayoutGap="10px" (change)="updateAmount()">
            <mat-radio-button class="balance" value="part" color="primary" (change)="setInputOutput('part', 'input')" checked="checked" fxFlex [disabled]="send.input === 'part'">
              <div class="name">公开</div>
              <div class="desc">可用余额:<span class="amount">{{ availableBalance('part') }}</span></div>
            </mat-radio-button>
            <mat-radio-button class="balance" value="blind" color="primary" (change)="setInputOutput('blind', 'input')" [disabled]="send.input === 'blind'" fxFlex>
              <div class="name">混肴</div>
              <div class="desc">可用余额:<span *ngIf="!checkBalance('blind')"
                                              class="amount">{{ availableBalance('blind') }}</span>
                <mat-icon *ngIf="checkBalance('blind')" fontSet="partIcon" fontIcon="part-circle-question"
                          class="help-icon"
                          matTooltip="即使所有余额转入混肴模式，混肴可用余额显示仍然很小，这是基于维公链的私密保护。"></mat-icon>
              </div>
            </mat-radio-button>
            <mat-radio-button *ngIf="testnet" class="balance" value="anon" color="primary" (change)="setInputOutput('anon', 'input')" [disabled]="send.input === 'anon'" fxFlex>
              <div class="name">匿名</div>
              <div class="desc">可用余额:<span class="amount">{{ availableBalance('anon') }}</span></div>
            </mat-radio-button>
          </mat-radio-group><!-- .from-balance-type -->
          <p class="widget-help">
	    通过转换交易类型，可以使您的余额在公开和私有之间进行转换。
          </p>
        </mat-card>


        <div class="section-title" *ngIf="type === 'sendPayment' || advanced">
          收款方
        </div>
        <mat-card class="pay-to" *ngIf="type === 'sendPayment' || advanced">

          <!-- Receiver's address/label -->
          <div class="section receiver-address">
            <div fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="15px">
              <mat-form-field fxFlex="1 1 100%" class="full-width larger">
                <input #address name="toAddress" matInput
                      [ngClass]="{'verify-sucess': checkAddress() === true, 'verify-error': checkAddress() === false }"
                      type="text" placeholder="接收的地址" [(ngModel)]="send.toAddress"
                      (ngModelChange)="verifyAddress()"/>
              </mat-form-field>
              <span fxFlex="0 0 16px">
                <mat-icon class="cursor-pointer" matTooltip="选取从地址簿中" (click)="openLookup()"
                          fontSet="partIcon" fontIcon="part-people"></mat-icon>
              </span>
              <span fxFlex="0 0 16px">
                <mat-icon class="cursor-pointer" matTooltip="剪贴" fontSet="partIcon" fontIcon="part-past"
                          (click)="pasteAddress()"></mat-icon>
              </span>
              <span fxFlex="0 0 16px">
                <mat-icon class="cursor-pointer" matTooltip="清除" (click)="clearReceiver()"
                          color="warn" fontSet="partIcon" fontIcon="part-clear-all"></mat-icon>
              </span>
            </div>
            <mat-form-field class="full-width larger no-top-padding" floatPlaceholder="never">
              <input name="toLabel" matInput type="text" placeholder="接收人的姓名 (选项)"
                    [(ngModel)]="send.toLabel">
            </mat-form-field>
            <p class="widget-help">
	      您可以将接收人的地址保存到您的地址簿中，方便日后使用。
            </p>
          </div><!-- .receiver-address.section -->

          <!-- Narrations -->
          <div class="section narration advanced" *ngIf="advanced">
            <mat-form-field class="full-width larger" floatPlaceholder="never">
              <input #narration type="text" matInput name="sendNote" placeholder="Narration (optional)" maxlength="24"
                    [(ngModel)]="send.narration">
              <mat-hint align="end">{{narration.value.length}} / 24</mat-hint>
            </mat-form-field>
            <p class="widget-help">
	      请注意：付款时的简短说明，如果是发送到公开地址时，这些说明将将在区块链上公开可见；如果是发送到混肴或匿名地址时，则仅仅发送方和接收方可见。
            </p>
          </div><!-- .narration.section -->
        </mat-card><!-- .pay-to -->

        <!-- Send amount % buttons -->
        <mat-card class="send-amount" fxLayout="row" fxLayoutGap="15px" fxLayoutAlign="start center">
          <mat-form-field fxFlex="0 0 150px">
            <!-- Send amount -->
            <input matInput type="text" name="sendAmount" placeholder="付款金额" [(ngModel)]="send.amount"
                  (input)="verifyAmount()"
                  [ngClass]="{'verify-sucess': checkAmount() === true, 'verify-error': checkAmount() === false }"
                  [disabled]="send.subtractFeeFromAmount">
          </mat-form-field>
          <mat-checkbox name="send_all" [(ngModel)]="send.subtractFeeFromAmount" (click)="sendAllBalance()"
                        class="send-all" color="warn">
            所有余额
          </mat-checkbox>
          <!-- Choose currency -->
          <mat-select class="underlining-select" fxFlex="0 0 70px" name="currency" [(ngModel)]="send.currency"
                      placeholder="单位">
            <mat-option value="part">VPC</mat-option>
          </mat-select>
          <!-- Send buttons -->
          <div class="actions" fxFlex="1 1 100%">
            <button mat-raised-button color="primary" class="validate" (click)="onSubmit()"
                    [disabled]="!checkAddress() || !checkAmount()">
              <mat-icon fontSet="partIcon" fontIcon="part-check"></mat-icon>
              付款
            </button>
          </div><!-- .actions -->
        </mat-card><!-- .send-amount -->


      </form><!-- walletSendForm -->
    </div><!-- .to-box -->

  </div><!-- flex row -->

</div><!-- .container -->
